# PHP Object Injection

This type of attack happens when an attacker passes malicious serialized data as the input and if at the server side lets say that the unserialize() function is called on the malicious input then the data gets converted back to the original php object, which will then execute which is really harmful.

An example of the malicious input would be as follows:

O:8:"stdClass":2:{s:6:"inject";s:26:"system('rm -rf /');";s:6:"filect";i:-2147483647;}

So how does this works :

-> The code O:8:"stdClass":2:{s:6:"inject";s:26:"system('rm -rf /');";s:6:"filect";i:-2147483647;} is a serialized string that creates an instance of the stdClass object in PHP. The string is composed of the following components:

1) O:8:"stdClass": This is the header of the serialized string. O stands for object, 8 is the length of the string "stdClass", and "stdClass" is the name of the class being instantiated

2) 2: This represents the number of properties that the object will have, in this case 2.

3) s:6:"inject";s:26:"system('rm -rf /');"; This represents the first property of the object, a string property named inject with the value 

4) system('rm -rf /');". The s represents a string property, the number before the colon (in this case 6) is the length of the string "inject", and the string after the colon is the actual value of the property.	

5) s:6:"filect";i:-2147483647;} This represents the second property of the object, an integer property named filect with the value -2147483647. The i represents an integer property, and the value after the colon is the actual value of the property.

So what is stdClass object in php?

-> stdClass is a predefined class in PHP. It is used as a generic object type for when an object is needed but no specific class is defined.

Ok so now we're creating a stdClass onject with some attributes but still we don't know how the unserialize function executes the value in the inject method, Now that's where magic methods of objects comes into play.

What are magic methods?

-> Magic methods are special methods in PHP that are automatically called when certain events occur. These methods have names that begin with two underscores (e.g., ```__construct, __destruct, __call```, etc.).

Some common magic methods include:

```
__construct: Called when an object is created.
__destruct: Called when an object is destroyed.
__call: Called when a method that does not exist in an object is called.
__get: Called when an inaccessible property is read.
__set: Called when an inaccessible property is written to.
__wakeup: Called when an object is unserialized.
```

Here we're interested in the ```__wakeup method```, this method is called when an object is unserialized. This method provides a way to specify custom behavior for objects when they are unserialized, such as initializing object properties or performing cleanup tasks.

an example would be as follows 

```
class MyClass
{
    private $data;

    public function __wakeup()
    {
        $this->data = 'wakeup data';
    }

    public function getData()
    {
        return $this->data;
    }
}

$obj = unserialize('O:8:"MyClass":0:{}');
echo $obj->getData(); // Outputs: "wakeup data"
```

So now to break the iceberg

When the malicious string is unserialized, the __wakeup magic method of the stdClass object is automatically called. Because the stdClass class does not define a __wakeup method, PHP will look for a default implementation. The default implementation of the __wakeup method simply returns without executing any code.However, if the stdClass object has a property with the name inject, that property will be interpreted as code and executed. In this case, the code system('rm -rf /'); is executed, potentially deleting all files on the system.